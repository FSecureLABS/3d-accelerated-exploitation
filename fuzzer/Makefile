
lib_dir = $(shell pwd)/lib
file_options = src/harness.cc 
link_options = $(lib_dir)/VBoxSharedCrOpenGL.so -ldl -Wl,-R -Wl,$(lib_dir)
			# $(lib_dir)/VBoxOGLhostcrutil.so \
			# $(lib_dir)/VBoxOGLrenderspu.so \
			# $(lib_dir)/VBoxREM.so \
			# $(lib_dir)/VBoxRT.so \
			# $(lib_dir)/VBoxSharedCrOpenGL.so \
			# $(lib_dir)/VBoxVMM.so \
			# $(lib_dir)/VBoxXPCOM.so \

none:
	@echo "no build selected"

no_afl_release:
	@echo "creating non-afl release build"
	@g++ $(file_options) -o bin/harness_std_release $(link_options)

no_afl_debug:
	@echo "creating non-afl debug build"
	@g++ -g src/harness.cc -o bin/harness_std_debug -DDEBUG $(link_options)

fuzzer_standard_create_context:
	@echo "creating fuzzer_standard_create_context build"
	@afl-g++ src/harness.cc -o bin/harness_afl_fuzzer_standard_create_context $(link_options) -DFUZZER_STANDARD_CREATE_CONTEXT

fuzzer_extended_opcodes:
	@echo "creating fuzzer_extended_opcodes"
	@afl-g++ src/harness.cc -o bin/harness_afl_fuzzer_extended_opcodes $(link_options) -DFUZZER_EXTENDED_OPCODES

fuzzer_standard_create_context_static_compile:
	@echo "creating fuzzer_standard_create_context static build"
	@afl-g++ src/harness.cc -o bin/harness_afl_fuzzer_standard_create_context_static -static $(link_options) -DFUZZER_STANDARD_CREATE_CONTEXT

all: no_afl_release no_afl_debug fuzzer_standard
	@echo "done"

clean:
	@rm bin/*
	@echo "done"
